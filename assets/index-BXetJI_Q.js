(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const f={400:"Bad request — the server could not understand the request.",401:"Unauthorized — please sign in to continue.",403:"Forbidden — you do not have permission to access this resource.",404:"Not found — the requested resource does not exist.",408:"Request timeout — the server took too long to respond. Try again.",429:"Too many requests — slow down and try again in a moment.",500:"Server error — something went wrong on our side. Please try later.",502:"Bad gateway — upstream service returned an invalid response.",503:"Service unavailable — the service is temporarily down. Try again later.",504:"Gateway timeout — upstream service timed out."};function b(r,e){const t=f[r];return t||`${e} (code ${r})`}function v(r,e){return b(r.status,e)}function E(r){const e=t=>{t.key==="Escape"&&r()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}function g(r){return r>=70?"ibu-very-high":r>=50?"ibu-high":r>=30?"ibu-medium":"ibu-low"}const y="https://api.jsonbin.io/v3/b/6630fd9be41b4d34e4ecd1f9";async function w(){try{const r=await fetch(y);if(!r.ok){const t=v(r,"Failed to load catalog data");throw new Error(t)}return(await r.json())?.record??[]}catch(r){throw console.error("API Fetch Error:",r),r instanceof Error?new Error(r.message):new Error("An unknown network error occurred while fetching products.")}}const C={products:[],isLoading:!1,error:null,selectedProduct:null};class S{_state={...C};_listeners=[];getState(){return this._state}setState(e){this._state={...this._state,...e},this.notify()}subscribe(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(t=>t!==e)}}notify(){this._listeners.forEach(e=>e())}async fetchData(){this.setState({isLoading:!0,error:null});try{const e=await w();this.setState({products:e,isLoading:!1,error:null})}catch(e){const t=e instanceof Error?e.message:"An unexpected API error occurred.";this.setState({products:[],isLoading:!1,error:t})}}setSelectedProduct(e){if(e===null){this.setState({selectedProduct:null});return}const t=this._state.products.find(n=>n.id===e)??null;t?this.setState({selectedProduct:t}):(console.error(`Product with ID ${e} not found.`),this.setState({selectedProduct:null}))}}const L=new S;class u{element;product;onClick;static observer=null;constructor(e,t){this.product=e,this.onClick=t,this.element=this.createElement(),this.attachEventListeners()}static ensureObserver(){u.observer||(u.observer=new IntersectionObserver(e=>{e.forEach(t=>{if(!t.isIntersecting)return;const n=t.target,s=n.dataset.src;s&&(n.src=s),u.observer&&u.observer.unobserve(n)})},{root:document.querySelector("#catalog-main"),rootMargin:"10px",threshold:.1}))}createElement(){const{id:e,name:t,abv:n,ibu:s,image_url:o}=this.product,i=g(s),a=document.createElement("article");a.className=`product-card ${i}`,a.setAttribute("data-product-id",String(e));const d="https://placehold.co/150x250/cccccc/333333?text=Loading";a.innerHTML=`
        <span class="abv-badge">${n}%</span>
        <div class="card-image-wrapper">
            <img
                src="${d}"
                data-src="${o}"
                alt="${t} image"
                class="card-image"
            >
            <div class="ibu-badge">
              <span class="spec-label">IBU:</span>
              <span class="spec-value">${s}</span>
            </div>
        </div>
        <div class="card-content">
            <h3>${t}</h3>
        </div>
    `;const l=a.querySelector("img.card-image");return l&&(l.addEventListener("error",()=>{l.src="https://placehold.co/150x250/cccccc/333333?text=No+Image"}),u.ensureObserver(),u.observer&&u.observer.observe(l)),a}attachEventListeners(){this.element.addEventListener("click",()=>this.onClick(this.product))}getElement(){return this.element}}class A{element;toggleButton;menu;isOpen=!1;items=["Glass","Can","Box"];quantities=["1","2","3"];constructor(){this.element=document.createElement("div"),this.element.className="order-dropdown-wrapper",this.element.appendChild(this.buildToggle()),this.menu=this.buildMenu(),this.menu.classList.add("hidden"),this.element.appendChild(this.menu),this.toggleButton=this.element.querySelector(".order-toggle"),this.attachListeners()}buildToggle(){const e=document.createElement("button");e.type="button",e.className="order-toggle",e.setAttribute("aria-expanded","false");const t=document.createElement("span");t.className="order-label",t.textContent="Order";const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("class","chev"),n.setAttribute("width","12"),n.setAttribute("height","12"),n.setAttribute("viewBox","0 0 24 24"),n.setAttribute("aria-hidden","true"),n.setAttribute("focusable","false"),n.innerHTML='<path fill="currentColor" d="M7 10l5 5 5-5z"/>',e.appendChild(t),e.appendChild(n),e}buildMenu(){const e=document.createElement("div");e.className="order-menu",e.setAttribute("role","menu"),e.setAttribute("aria-hidden","true");const t=document.createElement("ul");t.className="order-list",t.setAttribute("role","none");for(const n of this.items){const s=document.createElement("ul");s.className="order-item",s.setAttribute("data-key",n),s.setAttribute("role","none");const o=document.createElement("button");o.type="button",o.className="order-item-btn",o.setAttribute("role","menuitem"),o.textContent=n;const i=document.createElement("ul");i.className="order-submenu hidden",i.setAttribute("role","menu"),i.setAttribute("aria-hidden","true");for(const a of this.quantities){const d=document.createElement("ul");d.className="order-subentry";const l=document.createElement("button");l.type="button",l.className="order-subitem",l.setAttribute("role","menuitem"),l.textContent=a,d.appendChild(l),i.appendChild(d)}s.appendChild(o),s.appendChild(i),t.appendChild(s)}return e.appendChild(t),e}attachListeners(){this.element.addEventListener("click",t=>{const n=t.target;if(n.closest(".order-toggle")){t.stopPropagation(),this.toggleDropdown();return}if(n.classList.contains("order-item-btn")){const s=n.closest(".order-item");if(!s)return;const o=s.querySelector(".order-submenu");if(!o)return;this.element.querySelectorAll(".order-submenu").forEach(i=>{i!==o&&i.classList.add("hidden")}),o.classList.toggle("hidden"),t.stopPropagation();return}if(n.classList.contains("order-subitem")){const s=n.textContent?.trim(),o=n.closest(".order-item")?.getAttribute("data-key")??"";console.log("Order selected:",o,s),this.closeAll()}});const e=()=>this.closeAll();document.addEventListener("click",e)}toggleDropdown(e){if(e===!0){this.closeAll();return}this.isOpen=!this.isOpen,this.menu.classList.toggle("hidden",!this.isOpen),this.menu.setAttribute("aria-hidden",String(!this.isOpen)),this.toggleButton.setAttribute("aria-expanded",String(this.isOpen))}closeAll(){this.isOpen=!1,this.menu.classList.add("hidden"),this.menu.setAttribute("aria-hidden","true"),this.toggleButton.setAttribute("aria-expanded","false"),this.element.querySelectorAll(".order-submenu").forEach(e=>e.classList.add("hidden"))}getElement(){return this.element}}class I{overlayElement;modalContentElement=null;dropdownComponent;onClose;escapeUnsub=null;constructor(e){this.onClose=e.onClose;const t=document.getElementById("product-modal-overlay");if(!t)throw new Error("Modal container not found: add #product-modal-overlay to HTML.");this.overlayElement=t,this.modalContentElement=this.overlayElement.querySelector(".modal-body"),this.dropdownComponent=new A,this.ensureCloseButton(),this.attachEventListeners()}ensureCloseButton(){let e=this.overlayElement.querySelector(".modal-close-button");if(!e){const t=this.overlayElement.querySelector(".modal-content-area")||this.overlayElement;e=document.createElement("button"),e.className="modal-close-button",e.setAttribute("aria-label","Close modal"),e.innerHTML="&times;",t.appendChild(e)}e.addEventListener("click",()=>this.onClose())}attachEventListeners(){this.overlayElement.addEventListener("click",e=>{e.target===this.overlayElement&&this.onClose()})}show(e){if(!this.modalContentElement){const a=this.overlayElement.querySelector(".modal-content-area");if(!a){console.error("Modal content area not found.");return}const d=document.createElement("div");d.className="modal-body",a.appendChild(d),this.modalContentElement=d}const t=e.ibu??"—",n=e.abv??"—",s=g(e.ibu??0);this.modalContentElement.innerHTML=`
      <div class="modal-left">
        <div class="modal-image-circle ${s}" aria-hidden="false">
          <div class="modal-image-inner" aria-hidden="false">
            <img
              src="${e.image_url||"https://placehold.co/600x600/cccccc/333333?text=No+Image"}"
              alt="Image of ${e.name}"
              class="modal-product-image"
              onerror="this.onerror=null; this.src='https://placehold.co/600x600/cccccc/333333?text=No+Image';"
            />
          </div>
          <div class="modal-ibu" aria-label="IBU: ${t}">
            <span class="ibu-label">IBU</span>
            <span class="ibu-value">${t}</span>
          </div>
          <div class="modal-abv" aria-label="ABV: ${n}%">${n}%</div>
        </div>

        <h2 class="modal-title">${e.name}</h2>
      </div>

      <div class="modal-right">
        <div class="modal-right-body">
          <div class="modal-description">
            ${e.description??"<em>No description available.</em>"}
          </div>
          <div class="modal-footer" aria-label="Product options"></div>
        </div>
      </div>
    `;const i=this.overlayElement.querySelector(".modal-right .modal-footer")??this.overlayElement.querySelector(".modal-footer");if(i){const a=i.querySelector(".order-dropdown-wrapper");a&&i.removeChild(a),i.appendChild(this.dropdownComponent.getElement())}else console.error("Modal footer element not found for dropdown injection.");typeof this.dropdownComponent.toggleDropdown=="function"&&this.dropdownComponent.toggleDropdown(!0),this.escapeUnsub=E(()=>this.onClose()),this.overlayElement.classList.remove("hidden"),this.overlayElement.classList.add("is-visible"),document.body.classList.add("modal-open")}hide(){this.escapeUnsub&&(this.escapeUnsub(),this.escapeUnsub=null),this.overlayElement.classList.add("hidden"),this.overlayElement.classList.remove("is-visible"),document.body.classList.remove("modal-open")}}function m(r){const n=(location.hash||"").replace(/^#/,"").match(/^\/(\d+)?(?:\?(.*))?$/);if(!n)return{id:null,search:null};const s=n[1]?Number(n[1]):null,o=n[2]??"",a=new URLSearchParams(o).get("search");return{id:s,search:a}}function T(r,e){const n=r!=null?String(r):"",s=new URLSearchParams;e!=null&&e!==""&&s.set("search",e);const o=s.toString();return"#/"+n+(o?`?${o}`:"")}function p(r,e,t="replace"){const n=T(r,e??""),s=location.pathname+location.search+n;t==="replace"?(history.replaceState(null,"",s),window.dispatchEvent(new Event("hashchange"))):location.hash!==n?location.hash=n:window.dispatchEvent(new Event("hashchange"))}function N(r,e=300){let t;return(...n)=>{t!==void 0&&window.clearTimeout(t),t=window.setTimeout(()=>{r(...n),t=void 0},e)}}function h(r){r&&(r.style.display="",r.setAttribute("aria-hidden","false"))}function c(r){r&&(r.style.display="none",r.setAttribute("aria-hidden","true"))}function x(r,e){const n=(e??"").trim();if(!n)return r;const s=n.toLowerCase();if(Number.isFinite(Number(s))&&s!==""){const i=Number(s);return r.filter(a=>a.ibu===i||String(a.ibu).includes(s)||a.name.toLowerCase().includes(s))}return r.filter(i=>i.name.toLowerCase().includes(s)||String(i.ibu).includes(s))}class q{store;gridContainer=null;modalInstance;pendingHashId=null;loadingElement=null;emptyElement=null;errorElement=null;errorTextElement=null;modalOverlayElement=null;searchInput=null;searchTerm="";constructor(){this.store=L,this.modalInstance=new I({onClose:()=>this.handleModalClose()}),this.loadingElement=document.getElementById("loading-skeleton"),this.emptyElement=document.getElementById("empty-state"),this.errorElement=document.getElementById("error-state"),this.errorTextElement=this.errorElement?.querySelector(".error-text")??null,this.modalOverlayElement=document.getElementById("product-modal-overlay"),window.addEventListener("hashchange",()=>this.handleHashChange())}async init(){this.initGrid(),this.initSearch(),this.store.subscribe(()=>this.render()),this.handleHashChange(),await this.store.fetchData(),this.pendingHashId!==null&&(this.store.setSelectedProduct(this.pendingHashId),this.pendingHashId=null)}initGrid(){this.gridContainer=document.getElementById("product-grid")}initSearch(){if(this.searchInput=document.getElementById("product-search"),!this.searchInput)return;const e=N(t=>this.setSearchTerm(t),300);this.searchInput.addEventListener("input",t=>{const n=t.target.value||"";e(n)})}setSearchTerm(e,t=!0){const n=e.trim();if(this.searchTerm!==n){if(this.searchTerm=n,this.searchInput&&this.searchInput.value!==n&&(this.searchInput.value=n),t){const{selectedProduct:s}=this.store.getState(),o=s?s.id:null;p(o,this.searchTerm||"","replace")}this.render()}}render(){const{products:e,isLoading:t,error:n,selectedProduct:s}=this.store.getState();if(t){h(this.loadingElement),c(this.emptyElement),c(this.errorElement);return}if(n){c(this.loadingElement),c(this.emptyElement),h(this.errorElement),this.errorTextElement&&(this.errorTextElement.textContent=`Error fetching data: ${n}`);return}if(!e||e.length===0){c(this.loadingElement),c(this.errorElement),h(this.emptyElement);return}const o=x(e,this.searchTerm);c(this.loadingElement),c(this.emptyElement),c(this.errorElement),o.length===0?(this.gridContainer&&(this.gridContainer.innerHTML=""),h(this.emptyElement)):(c(this.emptyElement),this.gridContainer&&this.renderGrid(o)),s?(this.modalInstance.show(s),this.modalOverlayElement&&this.modalOverlayElement.setAttribute("aria-hidden","false")):(this.modalInstance.hide(),this.modalOverlayElement&&this.modalOverlayElement.setAttribute("aria-hidden","true"))}renderGrid(e){if(!this.gridContainer)return;const t=document.createDocumentFragment();e.forEach(n=>{const s=new u(n,o=>this.handleCardClick(o));t.appendChild(s.getElement())}),this.gridContainer.innerHTML="",this.gridContainer.appendChild(t)}handleCardClick(e){const{search:t}=m(),n=t||this.searchTerm||"";p(e.id,n,"push")}handleModalClose(){if(location.hash){const{search:e}=m(),t=e||this.searchTerm||"";p(null,t,"push")}else this.store.setSelectedProduct(null)}handleHashChange(){const e=m(),t=e.search??"";if(t!==this.searchTerm&&this.setSearchTerm(t,!1),e.id===null){this.pendingHashId=null,this.store.setSelectedProduct(null);return}const n=e.id,{products:s}=this.store.getState();if(!s||s.length===0){this.pendingHashId=n;return}this.pendingHashId=null,this.store.setSelectedProduct(n)}}function B(){try{new q().init(),console.log("Application initialized.")}catch(r){console.error("Failed to initialize the application:",r)}}document.addEventListener("DOMContentLoaded",B);
